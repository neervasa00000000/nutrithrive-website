<!DOCTYPE html>
<html lang="en-AU">
<head>
<script src="../../shared/js/defer-loader.js"></script>

<!-- Google tag (gtag.js) - Deferred for performance -->
<script>
  // Defer Google Analytics to prevent blocking initial render
  window.addEventListener('load', function() {
    var script = document.createElement('script');
    script.async = true;
    script.src = 'https://www.googletagmanager.com/gtag/js?id=G-WH21SW75WP';
    script.crossOrigin = 'anonymous';
    document.head.appendChild(script);
    
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-WH21SW75WP', {
      'anonymize_ip': true,
      'allow_google_signals': false
    });
  });
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>Moringa Powder ‚Äì 100% Pure Moringa Oleifera | NutriThrive (Test)</title>
    <meta name="description" content="NutriThrive Moringa Powder ‚Äì 100% pure moringa leaf powder. Lab-tested for potency, rich in vitamins & antioxidants. Boost energy, immunity & overall wellness. Shop online in Australia ‚Äì fast shipping from Truganina, Melbourne to Sydney and across Australia. Best protein powder Australia alternative, moringa brands comparison Australia 2026.">
    <meta name="keywords" content="moringa powder Australia, moringa, moringa oleifera powder, buy moringa powder, moringa benefits, superfood powder, health supplements Australia, moringa powder price, best protein powder Australia, moringa brands comparison Australia 2026, grow moringa tree Australia, Melbourne moringa, Sydney superfoods, Truganina health products, Victoria moringa powder">
    <meta name="author" content="NutriThrive Australia">
    <meta name="robots" content="noindex, nofollow">
    <meta name="language" content="en-AU">
    
    <!-- Simple Password Protection -->
    <style>
        #password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2d5a3d 0%, #1e4029 100%);
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        #password-form {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        #password-form h2 {
            color: #2d5a3d;
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
        }
        #password-form input {
            width: 100%;
            padding: 12px;
            margin: 1rem 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        #password-form input:focus {
            outline: none;
            border-color: #2d5a3d;
        }
        #password-form button {
            width: 100%;
            padding: 12px;
            background: #2d5a3d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        #password-form button:hover {
            background: #1e4029;
        }
        #password-error {
            color: #d32f2f;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            display: none;
        }
    </style>
    <meta name="geo.region" content="AU-VIC">
    <meta name="geo.placename" content="Melbourne">
    <meta name="last-modified" content="2026-01-30">
    
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://i.imgur.com">
    <link rel="preconnect" href="https://www.paypal.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    
    <!-- Critical CSS to prevent FOUC -->
    <style>
      /* Prevent FOUC - Hide content until CSS loads */
      html:not(.loaded) { visibility: hidden; opacity: 0; }
      html.loaded { visibility: visible; opacity: 1; transition: opacity 0.1s; }
      
      /* Critical above-the-fold styles */
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: #f8f5ec;
        color: #1a2e22;
        line-height: 1.6;
      }
      
      /* Header critical styles */
      header {
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        position: relative;
        z-index: 100;
      }
      
      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      /* Logo styles */
      .logo {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: #175c36;
        font-weight: 700;
        font-size: 1.5rem;
      }
      
      /* Nav links */
      .nav-links {
        display: flex;
        gap: 1.5rem;
        list-style: none;
        margin: 0;
        padding: 0;
      }
      
      .nav-links a {
        text-decoration: none;
        color: #1a2e22;
        font-weight: 500;
        transition: color 0.2s;
      }
    </style>
    
    <!-- Load CSS normally (blocking) to prevent FOUC -->
    <link rel="preload" as="style" href="../../shared/css/style.css">
    <link rel="preload" as="style" href="../../pages/products/product-detail.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../shared/css/style.css">
    <link rel="stylesheet" href="../../pages/products/product-detail.css">
    
    <!-- Mark page as loaded once CSS is ready -->
    <script>
      // Prevent FOUC - mark page as loaded once CSS is ready
      (function() {
        function markLoaded() {
          document.documentElement.classList.add('loaded');
        }
        
        // If CSS is already loaded
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
          setTimeout(markLoaded, 0);
        } else {
          window.addEventListener('load', markLoaded);
          // Fallback timeout
          setTimeout(markLoaded, 100);
        }
      })();
    </script>
    
    <style>
      /* Accordion smooth animation */
      .accordion-content {
        transition: max-height 0.3s ease-out, padding 0.3s ease-out, opacity 0.3s ease-out !important;
        overflow: hidden !important;
      }
      
      .accordion-content.active {
        display: block !important;
        max-height: none !important;
      }
      
      /* PayPal Button Container */
      #paypal-button-container {
        margin: 20px 0;
        min-height: 50px;
      }
      
      /* Mobile navigation */
      @media (max-width: 768px) {
        .nav-links {
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(255, 255, 255, 0.98);
          backdrop-filter: blur(10px);
          z-index: 2000;
          display: none;
          flex-direction: column;
          justify-content: flex-start;
          align-items: center;
          transform: translateX(-100%);
          transition: transform 0.3s ease-in-out;
          padding: 2rem 1.5rem 1rem;
          margin: 0;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          gap: 0.1rem;
        }
        
        .nav-links.nav-active {
          display: flex !important;
          transform: translateX(0);
        }
        
        .nav-links a {
          font-size: 1.1rem !important;
          margin: 0.05rem 0 !important;
          padding: 0.5rem 1rem !important;
          border-radius: 8px !important;
          transition: background-color 0.2s ease !important;
          text-align: center !important;
          width: 100% !important;
          max-width: 260px !important;
          display: flex !important;
          text-decoration: none !important;
          color: var(--primary) !important;
          font-weight: 600 !important;
          min-height: 40px !important;
          align-items: center !important;
          justify-content: center !important;
          background: transparent !important;
          border: none !important;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
          background-color: rgba(23, 92, 54, 0.1) !important;
          color: var(--accent) !important;
        }
        
        .hamburger {
          display: block !important;
          background: none !important;
          border: none !important;
          cursor: pointer !important;
          padding: 10px !important;
          min-width: 44px !important;
          min-height: 44px !important;
          -webkit-tap-highlight-color: transparent !important;
          touch-action: manipulation !important;
          z-index: 2001 !important;
          position: relative !important;
        }
        
        .hamburger div {
          width: 25px !important;
          height: 3px !important;
          background-color: var(--primary) !important;
          margin: 5px 0 !important;
          transition: all 0.2s ease !important;
          pointer-events: none !important;
        }
        
        .hamburger.toggle .line1 {
          transform: rotate(-45deg) translate(-5px, 6px) !important;
        }
        
        .hamburger.toggle .line2 {
          opacity: 0 !important;
        }
        
        .hamburger.toggle .line3 {
          transform: rotate(45deg) translate(-5px, -6px) !important;
        }
      }
    </style>
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="../../shared/images/Logo%20/LOGO.webp" sizes="32x32">
    <link rel="icon" type="image/png" sizes="16x16" href="../../shared/images/Logo%20/LOGO.webp">
    <link rel="apple-touch-icon" sizes="180x180" href="../../shared/images/Logo%20/LOGO.webp">
    <link rel="shortcut icon" href="../../shared/images/Logo%20/LOGO.webp">
    <meta name="msapplication-TileImage" content="../../shared/images/Logo%20/LOGO.webp">
    <meta name="msapplication-TileColor" content="#0f6b4d">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org/",
      "@type": "Product",
      "name": "Moringa Powder",
      "description": "Discover the amazing benefits of our 100% pure Moringa Oleifera leaf powder. Packed with antioxidants, vitamins, and minerals, it's the perfect supplement to boost your energy and support a healthy immune system.",
      "image": "https://i.imgur.com/56hwJfZ.png",
      "brand": {
        "@type": "Brand",
        "name": "NutriThrive"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "512"
      },
      "offers": {
        "@type": "Offer",
        "url": "https://nutrithrive.com.au/products/product-detail.html",
        "priceCurrency": "AUD",
        "price": "10.00",
        "priceValidUntil": "2026-12-31",
        "availability": "https://schema.org/InStock",
        "seller": {
          "@type": "Organization",
          "name": "NutriThrive"
        }
      }
    }
    </script>
</head>
<body class="product-page">
    <!-- Password Protection Overlay -->
    <div id="password-overlay">
        <div id="password-form">
            <h2>üîí Private Access</h2>
            <p style="color: #666; margin-bottom: 1rem;">Enter password to access this page</p>
            <input type="password" id="password-input" placeholder="Enter password" autocomplete="off" autofocus>
            <button onclick="checkPassword()">Access</button>
            <p id="password-error">Incorrect password. Please try again.</p>
        </div>
    </div>
    
    <script>
        // Simple password protection
        const CORRECT_PASSWORD = 'nutrithrive2026'; // Change this to your desired password
        
        function checkPassword() {
            const input = document.getElementById('password-input');
            const error = document.getElementById('password-error');
            const overlay = document.getElementById('password-overlay');
            
            if (input.value === CORRECT_PASSWORD) {
                overlay.style.display = 'none';
                // Store in sessionStorage so it persists during the session
                sessionStorage.setItem('testPageAuth', 'true');
            } else {
                error.style.display = 'block';
                input.value = '';
                input.focus();
            }
        }
        
        // Check if already authenticated in this session
        if (sessionStorage.getItem('testPageAuth') === 'true') {
            document.getElementById('password-overlay').style.display = 'none';
        }
        
        // Allow Enter key to submit
        document.getElementById('password-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
    </script>
    <header>
        <div class="navbar">
            <a href="/products/" class="logo">
                <img src="../../shared/images/Logo%20/LOGO.webp" alt="NutriThrive Logo" width="29" height="29" style="height: 1.8rem; width: auto; margin-right: 0.5rem;">
                NutriThrive
            </a>
            <a href="cart.html" class="cart-icon" style="position: relative; text-decoration: none; color: #1a2e22; font-size: 1.5rem; margin-left: auto; margin-right: 1rem;">
                üõí
                <span id="cart-count" style="position: absolute; top: -8px; right: -8px; background: #2d5a3d; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700;">0</span>
            </a>
            <nav class="nav-links">
                <a href="/">Home</a>
                <a href="/products/" class="active">Products</a>
                <a href="/pages/faq/faq.html">FAQ</a>
                <a href="/pages/shipping/shipping-returns.html">Shipping & Returns</a>
                <a href="/pages/about/about.html">About</a>
                <a href="/pages/contact/contact.html">Contact</a>
                <a href="/pages/usage-guide/how-to-use-moringa.html">Usage & Benefits</a>
                <a href="/blog/">Blog</a>
            </nav>
            <button class="hamburger" aria-label="Toggle navigation menu" onclick="window.ntToggleMenu && window.ntToggleMenu()">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </button>
        </div>
    </header>

    <main>
        <section class="product-detail-page">
            <div class="product-purchase-details">
                <h1 class="product-title">Moringa Powder</h1>
                
                <div class="product-content-wrapper">
                    <!-- Product Gallery - Left Side -->
                    <div class="product-gallery" style="position: relative !important; top: auto !important; height: auto !important; z-index: 1 !important;">
                        <div class="main-image" style="position: relative !important; width: 100% !important;">
                            <img id="main-product-image" src="../../shared/images/Home page /Moringa.png" alt="Moringa Powder - 100% Pure Moringa Oleifera" style="width: 100%; max-width: 350px; height: auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: block; position: relative !important;">
                        </div>
                        <div class="thumbnail-images">
                            <img class="thumbnail active" src="../../shared/images/Home page /Moringa.png" alt="Moringa Powder" onclick="changeMainImage(this.src)" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid #2d5a3d;">
                            <img class="thumbnail" src="../../shared/images/Home page /200g.png" alt="200g Moringa" onclick="changeMainImage(this.src)" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent;">
                            <img class="thumbnail" src="../../shared/images/Home page /200GSide.png" alt="200g Side View" onclick="changeMainImage(this.src)" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent;">
                            <img class="thumbnail" src="../../shared/images/Home page /1.png" alt="Moringa Product" onclick="changeMainImage(this.src)" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent;">
                        </div>
                    </div>
                    
                    <!-- Product Content - Right Side -->
                    <div class="product-content" style="display: block !important; visibility: visible !important; opacity: 1 !important; width: 100% !important; position: relative !important; z-index: 2 !important;">
                        <p class="product-description" style="display: block !important; visibility: visible !important; opacity: 1 !important; margin: 0 0 1.5rem 0 !important;">Discover the amazing benefits of our 100% pure Moringa Oleifera leaf powder. Packed with antioxidants, vitamins, and minerals, it's the perfect supplement to boost your energy and support a healthy immune system. Shipped fresh from Truganina, Melbourne to Sydney and across Australia. Our premium moringa powder contains complete amino acid profiles and natural plant-based nutrition for optimal health benefits.</p>

                        <!-- Product Price & Quantity -->
                        <div style="margin: 1.5rem 0; padding: 1rem; background: #f8faf7; border-radius: 8px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                <span style="font-size: 2rem; font-weight: 700; color: #2d5a3d;">$10.00 AUD</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <label style="font-weight: 600; color: #1a2e22;">Quantity:</label>
                                    <input type="number" id="product-quantity" min="1" value="1" style="width: 60px; padding: 0.5rem; border: 2px solid #e0e0e0; border-radius: 6px; text-align: center; font-size: 1rem;">
                                </div>
                            </div>
                            
                            <!-- Add to Cart Button -->
                            <button id="add-to-cart-btn" style="width: 100%; padding: 1rem; background: #2d5a3d; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background 0.3s; margin-bottom: 1rem;">
                                üõí Add to Cart
                            </button>
                            
                            <!-- Quick Buy with PayPal -->
                            <div style="text-align: center; padding: 10px 0; border-top: 1px solid #e0e0e0;">
                                <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">Or checkout directly with PayPal:</p>
                                <div id="paypal-button-container" style="display: block !important; visibility: visible !important; opacity: 1 !important; margin: 10px auto; max-width: 500px;"></div>
                            </div>
                        </div>
                
                <!-- RISK REVERSAL -->
                <div style="padding: 16px; margin: 16px 0; text-align: center; border-top: 1px solid #e0e0e0;">
                    <h2 style="color: #2d5a3d; margin: 0 0 8px 0; font-size: 1.25rem; font-weight: 600;">üõ°Ô∏è 7-Day Money-Back Guarantee</h2>
                    <p style="margin: 0; color: #2d5a3d;">Not satisfied? Full refund, no questions asked!</p>
                </div>
                </div>
                
            </div>

            <!-- Product information sections moved below the purchase block -->
            <div class="product-info-sections">
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('what-makes-special')">
                        <h2>What Makes NutriThrive<br>Moringa Powder Special?</h2>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content" id="what-makes-special">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; padding: 0.5rem 0;">
                            <div style="padding: 1.25rem; border-left: 3px solid #2d5a3d; background: linear-gradient(to right, rgba(45, 90, 61, 0.03), transparent); transition: transform 0.2s ease;">
                                <strong style="color: #2d5a3d; font-size: 1.15rem; display: block; margin-bottom: 0.6rem; font-weight: 700;">100% Natural</strong>
                                <p style="margin: 0; color: #555; line-height: 1.7; font-size: 0.95rem;">Pure Moringa Oleifera leaf powder with no synthetic additives, fillers, or artificial ingredients. Sourced directly from farms using traditional methods.</p>
                            </div>
                            <div style="padding: 1.25rem; border-left: 3px solid #2d5a3d; background: linear-gradient(to right, rgba(45, 90, 61, 0.03), transparent); transition: transform 0.2s ease;">
                                <strong style="color: #2d5a3d; font-size: 1.15rem; display: block; margin-bottom: 0.6rem; font-weight: 700;">Vegan</strong>
                                <p style="margin: 0; color: #555; line-height: 1.7; font-size: 0.95rem;">Plant-based and cruelty-free. Perfect for vegan and vegetarian diets. Contains all 9 essential amino acids for complete protein.</p>
                            </div>
                            <div style="padding: 1.25rem; border-left: 3px solid #2d5a3d; background: linear-gradient(to right, rgba(45, 90, 61, 0.03), transparent); transition: transform 0.2s ease;">
                                <strong style="color: #2d5a3d; font-size: 1.15rem; display: block; margin-bottom: 0.6rem; font-weight: 700;">Gluten Free</strong>
                                <p style="margin: 0; color: #555; line-height: 1.7; font-size: 0.95rem;">Naturally gluten-free. Safe for those with celiac disease or gluten sensitivity. Processed in a gluten-free facility.</p>
                            </div>
                            <div style="padding: 1.25rem; border-left: 3px solid #2d5a3d; background: linear-gradient(to right, rgba(45, 90, 61, 0.03), transparent); transition: transform 0.2s ease;">
                                <strong style="color: #2d5a3d; font-size: 1.15rem; display: block; margin-bottom: 0.6rem; font-weight: 700;">Antioxidant Rich</strong>
                                <p style="margin: 0; color: #555; line-height: 1.7; font-size: 0.95rem;">Contains 36+ antioxidants including Quercetin and Chlorogenic Acid. Fights free radicals and supports cellular health.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About NutriThrive</h3>
                <p>Dedicated to bringing you the finest natural wellness products for a healthier lifestyle.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/products/">Products</a></li>
                    <li><a href="/pages/about/about.html">About</a></li>
                    <li><a href="/pages/contact/contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <ul class="footer-links">
                    <li><a href="mailto:nutrithrive0@gmail.com">nutrithrive0@gmail.com</a></li>
                    <li><a href="tel:+61438201419">+61 438201419</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 NutriThrive. All rights reserved.</p>
        </div>
    </footer>

    <!-- Shopping Cart JavaScript -->
    <script>
        // Cart Management
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Update cart count
        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountEl = document.getElementById('cart-count');
            if (cartCountEl) {
                cartCountEl.textContent = count;
                cartCountEl.style.display = count > 0 ? 'flex' : 'none';
            }
        }
        
        // Add to cart
        function addToCart() {
            const quantity = parseInt(document.getElementById('product-quantity').value) || 1;
            const product = {
                id: 'moringa-powder',
                name: 'Moringa Powder',
                price: 10.00,
                quantity: quantity,
                image: '../../shared/images/Home page /Moringa.png'
            };
            
            // Check if product already in cart
            const existingIndex = cart.findIndex(item => item.id === product.id);
            if (existingIndex >= 0) {
                cart[existingIndex].quantity += quantity;
            } else {
                cart.push(product);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            
            // Show success message
            const btn = document.getElementById('add-to-cart-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úì Added to Cart!';
            btn.style.background = '#4caf50';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '#2d5a3d';
            }, 2000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            document.getElementById('add-to-cart-btn').addEventListener('click', addToCart);
        });
    </script>

    <!-- PayPal SDK - Load dynamically with retry mechanism -->
    <script>
        // Load PayPal SDK dynamically with retry mechanism
        function loadPayPalSDK(retryCount = 0) {
            const maxRetries = 3;
            const script = document.createElement('script');
            script.src = 'https://www.paypal.com/sdk/js?client-id=AWENgCZmgDmSWoCPafyEVah9MQmXbJpsNfaq8bQrHElnLCnqSJTNG34tMXtHRKBlDuKoTf49Po3iwcRV&currency=AUD&intent=capture';
            script.setAttribute('data-sdk-integration-source', 'button-factory');
            script.async = true;
            
            script.onload = function() {
                console.log('PayPal SDK loaded successfully');
                // Initialize PayPal buttons after SDK loads
                initPayPalButtons();
            };
            
            script.onerror = function() {
                console.error('PayPal SDK failed to load (attempt ' + (retryCount + 1) + ')');
                if (retryCount < maxRetries) {
                    console.log('Retrying PayPal SDK load...');
                    setTimeout(function() {
                        loadPayPalSDK(retryCount + 1);
                    }, 2000 * (retryCount + 1)); // Exponential backoff
                } else {
                    console.error('PayPal SDK failed to load after ' + maxRetries + ' attempts');
                    showPayPalError();
                }
            };
            
            document.head.appendChild(script);
        }
        
        function showPayPalError() {
            const container = document.getElementById('paypal-button-container');
            if (container) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: #d32f2f; background: #ffebee; border-radius: 8px; border: 2px solid #d32f2f;"><strong>PayPal SDK failed to load</strong><br><br>Please check your internet connection and refresh the page.<br><br><button onclick="location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #2d5a3d; color: white; border: none; border-radius: 4px; cursor: pointer;">Refresh Page</button></div>';
            }
        }
        
        // Initialize PayPal buttons
        function initPayPalButtons() {
            console.log('=== Initializing PayPal Buttons ===');
            console.log('PayPal object exists:', typeof paypal !== 'undefined');
            console.log('PayPal.Buttons exists:', typeof paypal !== 'undefined' && typeof paypal.Buttons === 'function');
            
            if (typeof paypal === 'undefined') {
                console.error('PayPal SDK not available - paypal is undefined');
                showPayPalError();
                return;
            }
            
            if (!paypal.Buttons) {
                console.error('PayPal SDK not available - Buttons function missing');
                console.log('Available PayPal properties:', Object.keys(paypal));
                showPayPalError();
                return;
            }
            
            const container = document.getElementById('paypal-button-container');
            if (!container) {
                console.error('PayPal button container not found');
                return;
            }
            
            // Clear any error messages
            container.innerHTML = '';
            
            console.log('Rendering PayPal buttons...');
            try {
                // PayPal Smart Buttons - Embedded Checkout (No Redirect)
                paypal.Buttons({
            style: {
                layout: 'vertical',
                color: 'gold',
                shape: 'rect',
                label: 'paypal'
            },
            createOrder: async function(data, actions) {
                console.log('=== Creating PayPal Order ===');
                console.log('Data:', data);
                console.log('Actions:', actions);
                
                // Try backend API first, fallback to client-side
                const quantity = parseInt(document.getElementById('product-quantity').value) || 1;
                const total = (10.00 * quantity).toFixed(2);
                
                console.log('Order details - Quantity:', quantity, 'Total:', total);
                
                // Try backend API first
                try {
                    console.log('Attempting backend API for product page...');
                    const response = await fetch(`${window.location.origin}/.netlify/functions/create-order`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            cart: [{
                                id: 'moringa-powder',
                                name: 'Moringa Powder',
                                price: 10.00,
                                quantity: quantity
                            }],
                            totals: {
                                subtotal: parseFloat(total),
                                shipping: 0,
                                total: parseFloat(total)
                            },
                            shipping: null
                        }),
                    });
                    
                    const orderData = await response.json();
                    console.log('Backend response:', orderData);
                    
                    if (response.ok && orderData.id) {
                        console.log('‚úÖ Backend API success:', orderData.id);
                        return orderData.id;
                    } else {
                        console.warn('‚ö†Ô∏è Backend API returned error, falling back to client-side');
                        throw new Error('Backend API error');
                    }
                } catch (backendError) {
                    console.warn('Backend API failed, using client-side fallback:', backendError);
                    // Fallback to client-side order creation
                    console.log('Using client-side order creation');
                    
                    try {
                        const orderRequest = {
                            purchase_units: [{
                                amount: {
                                    value: total,
                                    currency_code: 'AUD'
                                },
                                description: 'Moringa Powder - 100% Pure Moringa Oleifera',
                                items: [{
                                    name: 'Moringa Powder',
                                    description: '100% pure Moringa Oleifera leaf powder',
                                    quantity: quantity.toString(),
                                    unit_amount: {
                                        currency_code: 'AUD',
                                        value: '10.00'
                                    }
                                }]
                            }]
                        };
                        
                        console.log('Client-side order request:', orderRequest);
                        const orderId = await actions.order.create(orderRequest);
                        console.log('‚úÖ Client-side order created:', orderId);
                        return orderId;
                    } catch (clientError) {
                        console.error('‚ùå Client-side order creation failed:', clientError);
                        throw clientError;
                    }
                }
            },
            onApprove: async function(data, actions) {
                // Try backend API first, fallback to client-side
                try {
                    console.log('Attempting backend capture...');
                    const response = await fetch(`${window.location.origin}/.netlify/functions/capture-order`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            orderID: data.orderID
                        }),
                    });
                    
                    const orderData = await response.json();
                    
                    // Three cases to handle (per PayPal docs):
                    //   (1) Recoverable INSTRUMENT_DECLINED -> call actions.restart()
                    //   (2) Other non-recoverable errors -> Show a failure message
                    //   (3) Successful transaction -> Show confirmation
                    
                    const transaction = orderData?.purchase_units?.[0]?.payments?.captures?.[0] ||
                        orderData?.purchase_units?.[0]?.payments?.authorizations?.[0];
                    const errorDetail = orderData?.details?.[0];
                    
                    // Handle INSTRUMENT_DECLINED (recoverable)
                    if (errorDetail && errorDetail.issue === 'INSTRUMENT_DECLINED' && actions && actions.restart) {
                        return actions.restart();
                    }
                    
                    if (response.ok && transaction && transaction.status !== 'DECLINED') {
                        // (3) Success via backend
                        const orderId = transaction.id || orderData.id;
                        console.log('‚úÖ Backend capture success:', orderId);
                        alert('Payment successful! Order ID: ' + orderId + '\n\nThank you for your purchase!');
                        window.location.href = 'thank-you.html?orderId=' + orderId;
                        return;
                    } else {
                        // (2) Backend returned error, try client-side fallback
                        console.warn('‚ö†Ô∏è Backend capture failed, trying client-side fallback');
                        throw new Error('Backend capture error');
                    }
                } catch (backendError) {
                    console.warn('Backend capture failed, using client-side fallback:', backendError);
                    // Fallback to client-side capture
                    if (actions && actions.order) {
                        return actions.order.capture().then(function(details) {
                            console.log('‚úÖ Client-side capture success:', details.id);
                            alert('Payment successful! Order ID: ' + details.id + '\n\nThank you for your purchase!');
                            window.location.href = 'thank-you.html?orderId=' + details.id;
                        }).catch(function(err) {
                            console.error('‚ùå Client-side capture also failed:', err);
                            alert('Payment failed. Please try again or contact support at nutrithrive0@gmail.com\n\nError: ' + (err.message || JSON.stringify(err)));
                        });
                    } else {
                        alert('Payment failed. Please try again or contact support at nutrithrive0@gmail.com\n\nError: ' + (backendError.message || JSON.stringify(backendError)));
                    }
                }
            },
            onError: function(err) {
                // Handle buyer checkout errors
                console.error('=== PayPal Error ===');
                console.error('Error object:', err);
                console.error('Error type:', typeof err);
                console.error('Error message:', err?.message);
                console.error('Error details:', JSON.stringify(err, null, 2));
                
                // Don't show alert for every error - some might be recoverable
                // Only show critical errors
                if (err && err.message && !err.message.includes('INSTRUMENT_DECLINED')) {
                    let errorMsg = 'PayPal Error: ';
                    if (err.message) {
                        errorMsg += err.message;
                    } else if (typeof err === 'string') {
                        errorMsg += err;
                    } else {
                        errorMsg += 'Please check browser console (F12) for details.';
                    }
                    
                    // Show in console instead of alert to avoid interrupting user
                    console.error('User-facing error:', errorMsg);
                    
                    // Only show alert for critical errors
                    if (err.message && (
                        err.message.includes('INVALID_CLIENT_ID') ||
                        err.message.includes('AUTHENTICATION_FAILURE') ||
                        err.message.includes('UNAUTHORIZED')
                    )) {
                        alert('PayPal configuration error. Please contact support at nutrithrive0@gmail.com\n\nError: ' + err.message);
                    }
                }
            },
            onCancel: function(data) {
                // User cancelled the payment
                console.log('Payment cancelled:', data);
            }
                }).render('#paypal-button-container').then(function() {
                    console.log('‚úÖ PayPal buttons rendered successfully');
                }).catch(function(err) {
                    console.error('‚ùå PayPal button render error:', err);
                    console.error('Render error details:', JSON.stringify(err, null, 2));
                    showPayPalError();
                    alert('Failed to render PayPal buttons. Please check console (F12) for details.\n\nError: ' + (err.message || JSON.stringify(err)));
                });
            } catch (err) {
                console.error('PayPal initialization error:', err);
                showPayPalError();
            }
        }
        
        // Start loading PayPal SDK when page is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(loadPayPalSDK, 500);
            });
        } else {
            setTimeout(loadPayPalSDK, 500);
        }
    </script>

    <script>
        // Accordion functionality
        function toggleAccordion(sectionId) {
            const content = document.getElementById(sectionId);
            if (!content) return;
            
            const header = content.previousElementSibling;
            const section = content.parentElement;
            const isOpen = section.classList.contains('active') || content.classList.contains('active') || getComputedStyle(content).display !== 'none';
            
            if (isOpen) {
                const currentHeight = content.scrollHeight;
                content.style.maxHeight = currentHeight + 'px';
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        content.style.maxHeight = '0px';
                        content.style.opacity = '0';
                        content.style.paddingTop = '0';
                        content.style.paddingBottom = '0';
                    });
                });
                setTimeout(() => {
                    content.style.display = 'none';
                    content.classList.remove('active');
                    section.classList.remove('active');
                }, 400);
            } else {
                content.style.display = 'block';
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        const fullHeight = content.scrollHeight + 48;
                        content.style.maxHeight = fullHeight + 'px';
                        content.style.opacity = '1';
                        content.style.paddingTop = '1.5rem';
                        content.style.paddingBottom = '1.5rem';
                    });
                });
                content.classList.add('active');
                section.classList.add('active');
            }
        }
        window.toggleAccordion = toggleAccordion;
        
        // Product image gallery functionality
        function changeMainImage(newSrc) {
            const mainImage = document.getElementById('main-product-image');
            if (mainImage) {
                mainImage.src = newSrc;
            }
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach(thumb => {
                if (thumb.src === newSrc) {
                    thumb.classList.add('active');
                    thumb.style.border = '2px solid #2d5a3d';
                } else {
                    thumb.classList.remove('active');
                    thumb.style.border = '2px solid transparent';
                }
            });
        }
        window.changeMainImage = changeMainImage;
    </script>
    
    <script src="../../shared/js/script.js"></script>
    <script src="../../pages/products/product-detail.js"></script>
    
    <!-- Hamburger menu -->
    <script>
      (function() {
        function setupHamburger() {
          const hamburger = document.querySelector('.hamburger');
          const navLinks = document.querySelector('.nav-links');
          
          if (!hamburger || !navLinks) {
            setTimeout(setupHamburger, 100);
            return;
          }
          
          if (!window.ntToggleMenu) {
            window.ntToggleMenu = function() {
              const isOpen = navLinks.classList.contains('nav-active');
              if (isOpen) {
                navLinks.classList.remove('nav-active');
                hamburger.classList.remove('toggle');
                document.body.classList.remove('no-scroll');
                navLinks.style.display = '';
              } else {
                navLinks.classList.add('nav-active');
                hamburger.classList.add('toggle');
                document.body.classList.add('no-scroll');
                navLinks.style.display = 'flex';
              }
            };
          }
          
          hamburger.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            window.ntToggleMenu();
          });
        }
        
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', setupHamburger);
        } else {
          setupHamburger();
        }
      })();
    </script>
</body>
</html>
