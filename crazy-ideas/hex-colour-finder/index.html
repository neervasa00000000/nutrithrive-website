<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Photo Palette & Mood Analyzer | NutriThrive Quick Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Extract dominant colors from any photo and analyze its mood. Perfect for design inspiration.">
  <link rel="icon" type="image/png" href="https://i.imgur.com/bZubhoR.png">
  <link rel="apple-touch-icon" href="https://i.imgur.com/bZubhoR.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #511D43;
      --primary-light: #901E3E;
      --secondary: #DC2525;
      --accent: #9BC09C;
      --bg: #9BC09C;
      --text: #511D43;
      --text-light: #901E3E;
      --white: #ffffff;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
    }

    .hero-section {
      background: var(--primary);
      color: var(--white);
      padding: 4rem 2rem 3rem;
      text-align: center;
      position: relative;
    }

    .hero-section::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: var(--bg);
      border-radius: 40px 40px 0 0;
    }

    h1 {
      font-size: 3rem;
      font-weight: 900;
      margin-bottom: 0.75rem;
      letter-spacing: -2px;
      line-height: 1.1;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      font-weight: 400;
      opacity: 0.95;
      max-width: 600px;
      margin: 0 auto;
    }

    .main-container {
      max-width: 1400px;
      margin: -20px auto 0;
      padding: 0 2rem 4rem;
      position: relative;
      z-index: 1;
    }

    .upload-card {
      background: var(--white);
      border: 4px solid var(--primary);
      border-radius: 24px;
      padding: 3rem;
      margin-bottom: 3rem;
      text-align: center;
    }

    .upload-area {
      border: 3px dashed var(--accent);
      border-radius: 20px;
      padding: 4rem 2rem;
      background: var(--bg);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background: var(--white);
    }

    .upload-area.dragover {
      border-color: var(--secondary);
      background: var(--accent);
    }

    .upload-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      display: block;
    }

    .upload-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .upload-hint {
      font-size: 1rem;
      color: var(--text-light);
      font-weight: 500;
    }

    input[type="file"] {
      display: none;
    }

    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-top: 2rem;
    }

    .image-card {
      background: var(--white);
      border: 4px solid var(--primary);
      border-radius: 24px;
      padding: 2rem;
      display: none;
    }

    .image-card.show {
      display: block;
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .image-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .image-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      border: 3px solid var(--accent);
      background: var(--bg);
      padding: 0.5rem;
    }

    #canvas {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
    }

    .palette-card {
      background: var(--white);
      border: 4px solid var(--primary);
      border-radius: 24px;
      padding: 2.5rem;
      display: none;
    }

    .palette-card.show {
      display: block;
      animation: slideUp 0.5s ease-out 0.2s both;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 3px solid var(--accent);
    }

    .section-title {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--primary);
      letter-spacing: -1px;
    }

    .color-count {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-light);
      background: var(--bg);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 2px solid var(--accent);
    }

    .palette-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }

    .color-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .color-swatch {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 16px;
      border: 4px solid var(--primary);
      position: relative;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .color-swatch:hover {
      transform: scale(1.05) rotate(2deg);
      border-color: var(--secondary);
    }

    .color-info {
      text-align: center;
      width: 100%;
    }

    .color-hex {
      font-size: 1.2rem;
      font-weight: 800;
      color: var(--primary);
      font-family: 'Courier New', monospace;
      letter-spacing: 1px;
      margin-bottom: 0.75rem;
      display: block;
    }

    .mood-card {
      background: var(--primary);
      color: var(--white);
      border-radius: 20px;
      padding: 2.5rem;
      text-align: center;
      border: 4px solid var(--primary-light);
      display: none;
    }

    .mood-card.show {
      display: block;
      animation: slideUp 0.5s ease-out 0.4s both;
    }

    .mood-label {
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      opacity: 0.9;
      margin-bottom: 1rem;
    }

    .mood-title {
      font-size: 2.5rem;
      font-weight: 900;
      margin-bottom: 0.75rem;
      letter-spacing: -2px;
      line-height: 1.2;
    }

    .mood-desc {
      font-size: 1.2rem;
      font-weight: 500;
      opacity: 0.95;
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-light);
    }

    .empty-icon {
      font-size: 5rem;
      margin-bottom: 1.5rem;
      opacity: 0.6;
    }

    .empty-text {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .empty-hint {
      font-size: 1rem;
      color: var(--text-light);
      font-weight: 500;
    }

    .copy-btn {
      margin-top: 0.5rem;
      padding: 0.4rem 1rem;
      background: var(--primary);
      color: var(--white);
      border: 2px solid var(--primary);
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }

    .copy-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary-light);
    }

    .copy-btn.copied {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--primary);
    }

    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }

      .palette-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 640px) {
      .hero-section {
        padding: 3rem 1.5rem 2rem;
      }

      h1 {
        font-size: 2rem;
      }

      .hero-subtitle {
        font-size: 1rem;
      }

      .main-container {
        padding: 0 1rem 2rem;
      }

      .upload-card {
        padding: 2rem 1.5rem;
      }

      .upload-area {
        padding: 3rem 1.5rem;
      }

      .upload-icon {
        font-size: 3rem;
      }

      .upload-text {
        font-size: 1.25rem;
      }

      .palette-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }

      .mood-title {
        font-size: 1.75rem;
      }

      .mood-desc {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="hero-section">
    <h1>Photo Palette & Mood Analyzer</h1>
    <p class="hero-subtitle">Extract colors and discover the emotional essence of any image</p>
  </div>

  <div class="main-container">
    <div class="upload-card">
      <div class="upload-area" id="uploadArea">
        <span class="upload-icon">ðŸ“¸</span>
        <div class="upload-text">Drop your image here</div>
        <div class="upload-hint">or click to browse</div>
        <input type="file" id="photoInput" accept="image/*"/>
      </div>
    </div>

    <div class="content-grid">
      <div class="image-card" id="imageCard">
        <div class="image-title">Your Image</div>
        <div class="image-wrapper">
          <canvas id="canvas" width="600" height="450"></canvas>
        </div>
      </div>

      <div class="palette-card" id="paletteCard">
        <div class="section-header">
          <div class="section-title">Color Palette</div>
          <div class="color-count" id="colorCount">5 Colors</div>
        </div>
        <div class="palette-grid" id="paletteGrid"></div>
        <div class="mood-card" id="moodCard"></div>
      </div>
    </div>
  </div>

  <script>
    // Color extraction helper
    function getDominantColors(imgData, num = 5) {
      let pixels = [];
      
      for (let i = 0; i < imgData.data.length; i += 4) {
        let r = imgData.data[i];
        let g = imgData.data[i + 1];
        let b = imgData.data[i + 2];
        let a = imgData.data[i + 3];
        
        if (a > 200) {
          pixels.push([r, g, b]);
        }
      }

      let clusters = [];
      
      pixels.forEach(p => {
        let found = false;
        for (let c of clusters) {
          if (Math.abs(c[0] - p[0]) < 28 && 
              Math.abs(c[1] - p[1]) < 28 && 
              Math.abs(c[2] - p[2]) < 28) {
            c[0] = (c[0] * c[3] + p[0]) / (c[3] + 1);
            c[1] = (c[1] * c[3] + p[1]) / (c[3] + 1);
            c[2] = (c[2] * c[3] + p[2]) / (c[3] + 1);
            c[3]++;
            found = true;
            break;
          }
        }
        if (!found) {
          clusters.push([p[0], p[1], p[2], 1]);
        }
      });

      clusters = clusters.sort((a, b) => b[3] - a[3]);

      return clusters.slice(0, num).map(c => {
        const rgb = [Math.round(c[0]), Math.round(c[1]), Math.round(c[2])];
        return {
          rgb,
          hex: "#" + rgb.map(v => v.toString(16).padStart(2, '0')).join('').toUpperCase()
        };
      });
    }

    // Mood matching
    function getPaletteMood(palette) {
      if (!palette.length) return { main: "No colours found", desc: "" };

      let hsum = 0, ssum = 0, lsum = 0;

      palette.forEach(({ rgb }) => {
        let [r, g, b] = rgb.map(x => x / 255);
        let mx = Math.max(r, g, b);
        let mn = Math.min(r, g, b);
        let l = (mx + mn) / 2;
        let s = mx == mn ? 0 : (l < 0.5 ? (mx - mn) / (mx + mn) : (mx - mn) / (2 - mx - mn));
        
        let h;
        if (mx == mn) h = 0;
        else if (mx == r) h = (g - b) / (mx - mn);
        else if (mx == g) h = 2 + (b - r) / (mx - mn);
        else h = 4 + (r - g) / (mx - mn);
        
        h = ((h * 60 + 360) % 360) / 360;
        hsum += h;
        ssum += s;
        lsum += l;
      });

      hsum /= palette.length;
      ssum /= palette.length;
      lsum /= palette.length;

      if (lsum > 0.78) return { main: "Bright & Energetic", desc: "Uplifting, lively" };
      if (lsum < 0.29) return { main: "Moody & Deep", desc: "Dramatic, mysterious" };
      if (ssum > 0.51 && hsum > 0.85) return { main: "Vivid & Playful", desc: "Cheerful, cute" };
      if (ssum < 0.22) return { main: "Muted & Calm", desc: "Subtle, soft" };
      if (hsum > 0.11 && hsum < 0.30) return { main: "Fresh & Natural", desc: "Green, outdoorsy" };
      if (hsum > 0.54 && hsum < 0.70) return { main: "Sky & Tranquil", desc: "Cool, relaxed" };
      
      return { main: "Colorful Harmony", desc: "Balanced, creative" };
    }

    // Named color matching
    const namedColors = [
      { name: "Black", hex: "#000000" },
      { name: "White", hex: "#FFFFFF" },
      { name: "Red", hex: "#FF0000" },
      { name: "Lime", hex: "#00FF00" },
      { name: "Blue", hex: "#0000FF" },
      { name: "Yellow", hex: "#FFFF00" },
      { name: "Cyan", hex: "#00FFFF" },
      { name: "Magenta", hex: "#FF00FF" },
      { name: "Gray", hex: "#808080" },
      { name: "Orange", hex: "#FFA500" },
      { name: "Purple", hex: "#800080" },
      { name: "Pink", hex: "#FFC0CB" },
      { name: "Brown", hex: "#A52A2A" },
      { name: "Gold", hex: "#FFD700" },
      { name: "Teal", hex: "#008080" },
      { name: "Sky Blue", hex: "#87CEEB" },
      { name: "Indigo", hex: "#4B0082" },
      { name: "Coral", hex: "#FF7F50" },
      { name: "Navy", hex: "#000080" },
      { name: "Maroon", hex: "#800000" },
      { name: "Olive", hex: "#808000" },
      { name: "Lavender", hex: "#E6E6FA" },
      { name: "Salmon", hex: "#FA8072" },
      { name: "Turquoise", hex: "#40E0D0" },
      { name: "Beige", hex: "#F5F5DC" },
      { name: "Khaki", hex: "#F0E68C" },
      { name: "Crimson", hex: "#DC143C" },
      { name: "Plum", hex: "#DDA0DD" },
      { name: "Mint", hex: "#98FB98" },
      { name: "Peach", hex: "#FFE5B4" }
    ];

    function hexToRgb(hex) {
      hex = hex.replace(/^#/, '');
      let bigint = parseInt(hex, 16);
      return [(bigint >> 16) & 255, (bigint >> 8) & 255, bigint & 255];
    }

    function getDistance(rgb1, rgb2) {
      return Math.sqrt(
        Math.pow(rgb1[0] - rgb2[0], 2) +
        Math.pow(rgb1[1] - rgb2[1], 2) +
        Math.pow(rgb1[2] - rgb2[2], 2)
      );
    }

    function closestName(rgb) {
      let closest = namedColors[0];
      let minDist = getDistance(rgb, hexToRgb(closest.hex));
      
      for (let color of namedColors) {
        let dist = getDistance(rgb, hexToRgb(color.hex));
        if (dist < minDist) {
          closest = color;
          minDist = dist;
        }
      }
      
      return closest;
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Visual feedback handled by CSS class
      });
    }

    // UI handlers
    const photoInput = document.getElementById('photoInput');
    const uploadArea = document.getElementById('uploadArea');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const imageCard = document.getElementById('imageCard');
    const paletteCard = document.getElementById('paletteCard');
    const paletteGrid = document.getElementById('paletteGrid');
    const moodCard = document.getElementById('moodCard');
    const colorCount = document.getElementById('colorCount');

    // Click to upload
    uploadArea.addEventListener('click', () => photoInput.click());

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        photoInput.files = e.dataTransfer.files;
        handleFile(file);
      }
    });

    function handleFile(file) {
      const img = new window.Image();
      
      img.onload = function() {
        // Fit image to canvas
        let ratio = Math.min(canvas.width / img.width, canvas.height / img.height, 1);
        let w = img.width * ratio;
        let h = img.height * ratio;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, (canvas.width - w) / 2, (canvas.height - h) / 2, w, h);

        // Show image card
        imageCard.classList.add('show');

        // Extract palette
        let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const palette = getDominantColors(imgData, 5);

        // Show palette card
        paletteCard.classList.add('show');

        // Build palette grid
        paletteGrid.innerHTML = '';
        palette.forEach((c, index) => {
          const colorItem = document.createElement('div');
          colorItem.className = 'color-item';
          colorItem.style.animationDelay = `${index * 0.1}s`;
          colorItem.innerHTML = `
            <div class="color-swatch" style="background: ${c.hex}" title="Click to copy"></div>
            <div class="color-info">
              <span class="color-hex">${c.hex}</span>
              <button class="copy-btn" onclick="copyToClipboard('${c.hex}'); this.classList.add('copied'); setTimeout(() => this.classList.remove('copied'), 2000);">Copy</button>
            </div>
          `;
          paletteGrid.appendChild(colorItem);
        });

        // Update color count
        colorCount.textContent = `${palette.length} Colors`;

        // Display mood
        const mood = getPaletteMood(palette);
        moodCard.classList.add('show');
        moodCard.innerHTML = `
          <div class="mood-label">Mood Analysis</div>
          <div class="mood-title">${mood.main}</div>
          <div class="mood-desc">${mood.desc}</div>
        `;
      };

      img.src = URL.createObjectURL(file);
    }

    photoInput.onchange = function(e) {
      const file = e.target.files[0];
      if (file) {
        handleFile(file);
      }
    };

    // Make copyToClipboard available globally
    window.copyToClipboard = copyToClipboard;
  </script>
</body>
</html>
