<!DOCTYPE html>
<html lang="en-AU">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WH21SW75WP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-WH21SW75WP');
</script>

  <meta charset="UTF-8" />
  <title>Universal Converter | PDF ‚Üî TXT ‚Üî URL | NutriThrive Quick Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Free universal converter: PDF to TXT, TXT to PDF, and URL to multiple formats (text, PDF, image, Markdown). All conversions happen in your browser." />
  <link rel="icon" type="image/png" href="https://i.imgur.com/bZubhoR.png">
  <link rel="apple-touch-icon" href="https://i.imgur.com/bZubhoR.png">
  <link rel="shortcut icon" href="https://i.imgur.com/bZubhoR.png">
  <style>
    :root {
      --bg: #b7e2c3;
      --surface: #ffffff;
      --surface-alt: #eef6f1;
      --accent: #38677a;
      --accent-light: #5f8b9d;
      --ink: #0f2530;
      --muted: #4c646c;
      --border: #86a8b5;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--ink);
      min-height: 100vh;
    }

    a { color: var(--accent); }

    .app-shell {
      max-width: 1180px;
      margin: 0 auto;
      padding: 48px 20px 80px;
      display: flex;
      flex-direction: column;
      gap: 32px;
    }

    .hero {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 36px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 32px;
    }

    .eyebrow {
      font-size: 0.82rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent-light);
    }

    .hero h1 {
      margin: 8px 0;
      font-size: clamp(2.2rem, 4vw, 3.4rem);
      letter-spacing: -0.02em;
    }

    .hero p {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }

    .hero-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 18px;
    }

    .badge {
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 0.85rem;
      background: var(--surface-alt);
      color: var(--accent);
    }

    .timeline {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    .step {
      position: relative;
      display: flex;
      align-items: flex-start;
      gap: 14px;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 18px;
      background: var(--surface);
    }

    .step-number {
      min-width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      background: var(--surface-alt);
      color: var(--accent);
    }

    .step-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 700;
      color: var(--accent);
    }

    .step-copy {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.4;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 24px;
    }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
    }

    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .panel-title {
      margin: 0;
      font-size: 1rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .helper-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }

    .helper-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: var(--surface-alt);
      font-size: 0.9rem;
      line-height: 1.4;
      color: var(--muted);
    }

    .drop-zone {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 30px;
      text-align: center;
      background: var(--surface-alt);
      color: var(--muted);
      cursor: pointer;
    }

    .drop-zone.dragover {
      border-color: var(--accent);
    }

    .btn-row { display: flex; gap: 10px; flex-wrap: wrap; }

    .btn {
      border-radius: 10px;
      padding: 10px 18px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--ink);
    }

    .btn.accent {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .btn:disabled { opacity: 0.4; cursor: not-allowed; }

    .status {
      color: var(--muted);
      font-size: 0.95rem;
      padding: 10px 14px;
      border-radius: 10px;
      background: var(--surface-alt);
      border: 1px solid var(--border);
    }

    .results {
      display: none;
      flex-direction: column;
      gap: 14px;
      border-top: 1px solid var(--accent-soft);
      padding-top: 16px;
    }

    textarea {
      width: 100%;
      min-height: 260px;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 16px;
      background: #fff;
      color: var(--ink);
      font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, monospace;
    }

    .email-box { display: flex; gap: 10px; flex-wrap: wrap; }

    .email-box input {
      flex: 1;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 10px 14px;
      background: #fff;
      color: var(--ink);
    }

    .cta-card {
      border: 1px solid var(--border);
      border-radius: 16px;
      background: var(--surface-alt);
      padding: 18px;
      color: var(--ink);
    }

    .cta-links { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }

    .cta-links a {
      border-radius: 24px;
      padding: 8px 14px;
      border: 1px solid var(--accent);
      background: var(--accent);
      color: #fff;
      text-decoration: none;
      font-weight: 600;
    }

    .secondary-panel {
      gap: 20px;
    }

    #txtPanel {
      gap: 18px;
    }

    /* URL Converter Styles */
    .url-input-section {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .url-input-section input {
      flex: 1;
      min-width: 200px;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 12px 16px;
      background: #fff;
      color: var(--ink);
      font-size: 1rem;
    }

    .url-input-section input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .format-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .format-btn {
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--ink);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .format-btn:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .format-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .preview-area {
      margin-top: 16px;
      padding: 16px;
      background: var(--surface-alt);
      border-radius: 12px;
      border: 1px solid var(--border);
      max-height: 400px;
      overflow-y: auto;
    }

    .preview-area img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 0.85rem;
    }
  </style>
  <script src="pdf.min.js"></script>
  <script src="pdf.worker.min.js" type="text/javascript"></script>
  <script src="jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turndown@7.1.3/dist/turndown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    if (window.pdfjsLib) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdf.worker.min.js';
    }
  </script>
</head>
<body>
  <div class="app-shell">
    <header class="hero">
      <div>
        <p class="eyebrow">NutriThrive Labs</p>
        <h1>Universal Converter</h1>
        <p>Convert PDF ‚Üî TXT ‚Üî URL to any format. PDF to text, text to PDF, or paste any webpage URL and get it as plain text, PDF, image, or Markdown‚Äîall in your browser.</p>
        <div class="hero-badges">
          <span class="badge">Runs offline</span>
          <span class="badge">No upload limits</span>
          <span class="badge">AU privacy friendly</span>
        </div>
      </div>
      <div></div>
    </header>

    <!-- URL Converter Section -->
    <section class="panel">
      <div class="panel-header">
        <p class="panel-title">üåê URL to Any Format</p>
        <small style="color:var(--muted);">Convert any webpage</small>
      </div>
      <div class="url-input-section">
        <input type="url" id="urlInput" placeholder="https://example.com" />
        <button class="btn accent" id="fetchUrlBtn">Fetch & Convert</button>
      </div>
      <div class="status" id="urlStatus">Enter a webpage URL above</div>
      <div class="format-buttons" id="formatButtons" style="display:none;">
        <button class="format-btn" id="toTextBtn">üìÑ Plain Text</button>
        <button class="format-btn" id="toPdfBtn">üìë PDF</button>
        <button class="format-btn" id="toImageBtn">üñºÔ∏è Image (PNG)</button>
        <button class="format-btn" id="toMarkdownBtn">üìù Markdown</button>
      </div>
      <div class="preview-area" id="urlPreview" style="display:none;"></div>
    </section>

    <section class="timeline">
      <div class="step">
        <div class="step-number">1</div>
        <div>
          <p class="step-title">Drop or browse your PDF</p>
          <p class="step-copy">Drag it anywhere on the page or tap "Load demo" to see how it works.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div>
          <p class="step-title">Convert & copy text</p>
          <p class="step-copy">Hit "Convert to TXT" and grab the clean text with one click.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div>
          <p class="step-title">Export or email yourself</p>
          <p class="step-copy">Download the .txt file or email it to yourself for quick sharing.</p>
        </div>
      </div>
    </section>

    <div class="layout">
      <section class="panel primary-panel">
        <div class="panel-header">
          <p class="panel-title">Upload your PDF</p>
          <small style="color:var(--muted);">Max ~25 MB</small>
        </div>
        <div class="drop-zone" id="dropZone">
          <p><strong>Drop your PDF anywhere here</strong></p>
          <p>or click to browse your device</p>
          <small>Text-based PDFs convert fastest.</small>
        </div>
        <input type="file" id="fileInput" accept="application/pdf" style="display:none" />
        <div class="btn-row">
          <button class="btn outline" id="sampleBtn">Load demo PDF</button>
          <button class="btn accent" id="convertBtn" disabled>Convert to TXT</button>
        </div>
        <div class="status" id="statusText" aria-live="polite">No file selected.</div>
        <div class="helper-grid">
          <div class="helper-card">Best results: digital PDFs (not scans). Need OCR? Run it first, then come back here.</div>
          <div class="helper-card">We never upload or store anything. All parsing lives in your browser tab.</div>
          <div class="helper-card">Team tip: convert, copy, then paste into your research notes or Notion docs.</div>
        </div>
      </section>

      <section class="panel secondary-panel">
        <div class="panel-header">
          <p class="panel-title">Download & share</p>
          <small style="color:var(--muted);">Outputs stay in this tab</small>
        </div>
        <div class="results" id="resultsBlock">
          <textarea id="textOutput" spellcheck="false"></textarea>
          <div class="btn-row">
            <button class="btn accent" id="downloadBtn">Download TXT</button>
            <button class="btn outline" id="copyBtn">Copy text</button>
          </div>
          <label for="emailInput" style="font-weight:600;">Email it to yourself (optional)</label>
          <div class="email-box">
            <input type="email" id="emailInput" placeholder="you@example.com" />
            <button class="btn accent" id="emailBtn">Email me</button>
          </div>
          <small style="color:var(--muted);">We'll open your email app with the text already pasted.</small>
        </div>
        <div class="cta-card">
          <h3 style="margin-top:0;">Stay sharp while you work</h3>
          <p>Converted your doc? Reward yourself with clean energy:</p>
          <div class="cta-links">
            <a href="https://nutrithrive.com.au/pages/products/product-detail.html">Moringa Focus Powder ‚Üí</a>
            <a href="https://nutrithrive.com.au/pages/products/product-curry-leaves.html">Dried Curry Leaves ‚Üí</a>
            <a href="https://nutrithrive.com.au/pages/products/product-black-tea.html">Darjeeling Brain Tea ‚Üí</a>
            <a href="https://nutrithrive.com.au/pages/blog/blog.html">More free wellness tools ‚Üí</a>
          </div>
        </div>
      </section>
    </div>

    <section class="panel" id="txtPanel">
      <div class="panel-header">
        <p class="panel-title">TXT ‚Üí PDF studio</p>
        <small style="color:var(--muted);">Make formatted PDFs from simple notes.</small>
      </div>
      <textarea id="txtInput" placeholder="Type or paste your text here..." style="min-height:220px;"></textarea>
      <div class="btn-row">
        <button class="btn outline" id="txtUploadBtn">Upload .txt</button>
        <button class="btn outline" id="txtSampleBtn">Load sample text</button>
        <button class="btn accent" id="txtConvertBtn">Make PDF</button>
      </div>
      <input type="file" id="txtFileInput" accept="text/plain" style="display:none" />
      <div class="status" id="txtStatus">Waiting for your words.</div>
    </section>

    <footer>
      Conversion happens locally using PDF.js. Scanned/image-only PDFs may need OCR before extracting text. URL conversion uses CORS proxy for fetching content.
    </footer>
  </div>

  <script>
    const SAMPLE_PDF_BASE64 = `JVBERi0xLjMKJZOMi54gUmVwb3J0TGFiIEdlbmVyYXRlZCBQREYgZG9jdW1lbnQgaHR0cDovL3d3dy5yZXBvcnRsYWIuY29tCjEgMCBvYmoKPDwKL0YxIDIgMCBSCj4+CmVuZG9iagoyIDAgb2JqCjw8Ci9CYXNlRm9udCAvSGVsdmV0aWNhIC9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nIC9OYW1lIC9GMSAvU3VidHlwZSAvVHlwZTEgL1R5cGUgL0ZvbnQKPj4KZW5kb2JqCjMgMCBvYmoKPDwKL0NvbnRlbnRzIDcgMCBSIC9NZWRpYUJveCBbIDAgMCA2MTIgNzkyIF0gL1BhcmVudCA2IDAgUiAvUmVzb3VyY2VzIDw8Ci9Gb250IDEgMCBSIC9Qcm9jU2V0IFsgL1BERiAvVGV4dCAvSW1hZ2VCIC9JbWFnZUMgL0ltYWdlSSBdCj4+IC9Sb3RhdGUgMCAvVHJhbnMgPDwKCj4+IAogIC9UeXBlIC9QYWdlCj4+CmVuZG9iago0IDAgb2JqCjw8Ci9QYWdlTW9kZSAvVXNlTm9uZSAvUGFnZXMgNiAwIFIgL1R5cGUgL0NhdGFsb2cKPj4KZW5kb2JqCjUgMCBvYmoKPDwKL0F1dGhvciAoYW5vbnltb3VzKSAvQ3JlYXRpb25EYXRlIChEOjIwMjUxMTE3MjIxOTE2KzExJzAwJykgL0NyZWF0b3IgKFJlcG9ydExhYiBQREYgTGlicmFyeSAtIHd3dy5yZXBvcnRsYWIuY29tKSAvS2V5d29yZHMgKCkgL01vZERhdGUgKEQ6MjAyNTExMTcyMjE5MTYrMTEnMDAnKSAvUHJvZHVjZXIgKFJlcG9ydExhYiBQREYgTGlicmFyeSAtIHd3dy5yZXBvcnRsYWIuY29tKSAKICAvU3ViamVjdCAodW5zcGVjaWZpZWQpIC9UaXRsZSAodW50aXRsZWQpIC9UcmFwcGVkIC9GYWxzZQo+PgplbmRvYmoKNiAwIG9iago8PAovQ291bnQgMSAvS2lkcyBbIDMgMCBSIF0gL1R5cGUgL1BhZ2VzCj4+CmVuZG9iago3IDAgb2JqCjw8Ci9GaWx0ZXIgWyAvQVNDSUk4NURlY29kZSAvRmxhdGVEZWNvZGUgXSAvTGVuZ3RoIDI1MAo+PgpzdHJlYW0KR2FyVzM1bXRPYCUjKzBMTVdbXUY5TnNwVC5fOmgkP2olIUhhcWU6JVhlWTdmcmQzczFnZDFMJWFGZWwkI1lbUkFbXGo7NSxgRUI7K1tIcCNCZmxROVlicDovVD0rWUJROVNgKCY5QV5HIT5RSTxDMll1azxdPnRpLl1QUj9eSWo2UillZGE/ckpCZHNBckFVLkVwWEY2aSxmQE1cMWZSRnInXypVTmhKVktKUyxkMmhCb3NbM1k+N2cySmJQMmhuZGxHPyFeTmFbJ29bWjQwKypBS1pZNFpccjZcW2lATygxY0RxMSYtRVM7JHJRWWY3NFRTZE08PEV+PmVuZHN0cmVhbQplbmRvYmoKeHJlZgowIDgKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMDczIDAwMDAwIG4gCjAwMDAwMDAxMDQgMDAwMDAgbiAKMDAwMDAwMDIxMSAwMDAwMCBuIAowMDAwMDAwNDA0IDAwMDAwIG4gCjAwMDAwMDA0NzIgMDAwMDAgbiAKMDAwMDAwMDc2OCAwMDAwMCBuIAowMDAwMDAwODI3IDAwMDAwIG4gCnRyYWlsZXIKPDwKL0lEIAlgPDhkNWY4MjZhMTQ1NWExNjk4MTViZWNkYzUzODMzNWVhPjw4ZDVmODI2YTE0NTVhMTY5ODE1YmVjZGM1MzgzMzVlYT5dCiUgUmVwb3J0TGFiIGdlbmVyYXRlZCBQREYgZG9jdW1lbnQgLS0gZGlnZXN0IChodHRwOi8vd3d3LnJlcG9ydGxhYi5jb20pCgovSW5mbyA1IDAgUgovUm9vdCA0IDAgUgovU2l6ZSA4Cj4+CnN0YXJ0eHJlZgoxMTY3CiUlRU9G\n`;

    // URL Converter Elements
    const urlInput = document.getElementById('urlInput');
    const fetchUrlBtn = document.getElementById('fetchUrlBtn');
    const urlStatus = document.getElementById('urlStatus');
    const formatButtons = document.getElementById('formatButtons');
    const urlPreview = document.getElementById('urlPreview');
    const toTextBtn = document.getElementById('toTextBtn');
    const toPdfBtn = document.getElementById('toPdfBtn');
    const toImageBtn = document.getElementById('toImageBtn');
    const toMarkdownBtn = document.getElementById('toMarkdownBtn');

    let fetchedHtml = '';
    let fetchedText = '';
    let fetchedUrl = '';

    // CORS Proxy function
    async function fetchWithProxy(url) {
      try {
        // Try direct fetch first
        const response = await fetch(url, {
          mode: 'cors',
          headers: {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
          }
        });
        if (response.ok) {
          return await response.text();
        }
      } catch (e) {
        console.log('Direct fetch failed, trying proxy');
      }

      // Use CORS proxy as fallback
      const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
      const response = await fetch(proxyUrl);
      const data = await response.json();
      return data.contents;
    }

    // Extract text from HTML
    function htmlToText(html) {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
      
      // Remove script and style elements
      const scripts = tempDiv.querySelectorAll('script, style');
      scripts.forEach(el => el.remove());
      
      // Get text content
      let text = tempDiv.innerText || tempDiv.textContent || '';
      
      // Clean up whitespace
      text = text.replace(/\s+/g, ' ').trim();
      text = text.replace(/\n\s*\n/g, '\n\n');
      
      return text;
    }

    // HTML to Markdown converter
    function htmlToMarkdown(html) {
      if (typeof TurndownService === 'undefined') {
        return 'Markdown converter not loaded. Please reload the page.';
      }
      try {
        const turndownService = new TurndownService({
          headingStyle: 'atx',
          codeBlockStyle: 'fenced'
        });
        return turndownService.turndown(html);
      } catch (e) {
        console.error('Markdown conversion error:', e);
        return htmlToText(html);
      }
    }

    // Fetch URL content
    fetchUrlBtn.addEventListener('click', async () => {
      const url = urlInput.value.trim();
      if (!url) {
        urlStatus.textContent = 'Please enter a valid URL';
        return;
      }

      // Validate URL
      try {
        new URL(url);
      } catch (e) {
        urlStatus.textContent = 'Invalid URL format. Please include http:// or https://';
        return;
      }

      fetchUrlBtn.disabled = true;
      urlStatus.textContent = 'Fetching webpage...';
      formatButtons.style.display = 'none';
      urlPreview.style.display = 'none';

      try {
        fetchedHtml = await fetchWithProxy(url);
        fetchedText = htmlToText(fetchedHtml);
        fetchedUrl = url;
        
        urlStatus.textContent = `‚úì Fetched successfully! Choose a format below.`;
        formatButtons.style.display = 'grid';
        
        // Show preview
        urlPreview.style.display = 'block';
        urlPreview.innerHTML = `
          <div style="margin-bottom:12px;font-weight:600;color:var(--accent);">Preview:</div>
          <div style="max-height:200px;overflow-y:auto;font-size:0.9rem;line-height:1.6;">
            ${fetchedText.substring(0, 500)}${fetchedText.length > 500 ? '...' : ''}
          </div>
        `;
      } catch (error) {
        console.error('Fetch error:', error);
        urlStatus.textContent = 'Failed to fetch webpage. The site may block CORS or require authentication.';
      } finally {
        fetchUrlBtn.disabled = false;
      }
    });

    // Convert to Plain Text
    toTextBtn.addEventListener('click', () => {
      if (!fetchedText) return;
      const blob = new Blob([fetchedText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `webpage-${new Date().getTime()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      urlStatus.textContent = '‚úì Plain text downloaded!';
    });

    // Convert to PDF
    toPdfBtn.addEventListener('click', () => {
      if (!fetchedText || !window.jspdf) {
        urlStatus.textContent = 'PDF generator not available. Please reload.';
        return;
      }
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'pt', format: 'a4' });
        const margin = 48;
        const width = doc.internal.pageSize.getWidth() - margin * 2;
        const lines = doc.splitTextToSize(fetchedText, width);
        
        doc.setFont('Helvetica', 'Normal');
        doc.setFontSize(10);
        
        let y = margin + 12;
        for (let i = 0; i < lines.length; i++) {
          if (y > doc.internal.pageSize.getHeight() - margin) {
            doc.addPage();
            y = margin;
          }
          doc.text(lines[i], margin, y);
          y += 12;
        }
        
        const filename = `webpage-${new Date().getTime()}.pdf`;
        doc.save(filename);
        urlStatus.textContent = '‚úì PDF downloaded!';
      } catch (error) {
        console.error('PDF error:', error);
        urlStatus.textContent = 'Failed to create PDF.';
      }
    });

    // Convert to Image
    toImageBtn.addEventListener('click', async () => {
      if (!fetchedHtml || typeof html2canvas === 'undefined') {
        urlStatus.textContent = 'Image converter not available. Please reload.';
        return;
      }
      
      try {
        urlStatus.textContent = 'Rendering image...';
        
        // Create temporary iframe to render HTML
        const iframe = document.createElement('iframe');
        iframe.style.position = 'absolute';
        iframe.style.left = '-9999px';
        iframe.style.width = '1200px';
        iframe.style.height = '800px';
        document.body.appendChild(iframe);
        
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(fetchedHtml);
        iframeDoc.close();
        
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        const canvas = await html2canvas(iframeDoc.body, {
          width: 1200,
          height: iframeDoc.body.scrollHeight,
          useCORS: true,
          allowTaint: true
        });
        
        canvas.toBlob((blob) => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `webpage-${new Date().getTime()}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          document.body.removeChild(iframe);
          urlStatus.textContent = '‚úì Image downloaded!';
        });
      } catch (error) {
        console.error('Image error:', error);
        urlStatus.textContent = 'Failed to create image. Some sites block iframe rendering.';
      }
    });

    // Convert to Markdown
    toMarkdownBtn.addEventListener('click', () => {
      if (!fetchedHtml) return;
      const markdown = htmlToMarkdown(fetchedHtml);
      const blob = new Blob([markdown], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `webpage-${new Date().getTime()}.md`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      urlStatus.textContent = '‚úì Markdown downloaded!';
    });

    // Enter key support for URL input
    urlInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        fetchUrlBtn.click();
      }
    });

    // Existing PDF to TXT code
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const convertBtn = document.getElementById('convertBtn');
    const sampleBtn = document.getElementById('sampleBtn');
    const statusText = document.getElementById('statusText');
    const resultsBlock = document.getElementById('resultsBlock');
    const textOutput = document.getElementById('textOutput');
    const downloadBtn = document.getElementById('downloadBtn');
    const copyBtn = document.getElementById('copyBtn');
    const emailBtn = document.getElementById('emailBtn');
    const emailInput = document.getElementById('emailInput');

    let currentFile = null;
    let extractedText = '';

    function setStatus(msg) {
      statusText.textContent = msg;
    }

    function resetResults() {
      resultsBlock.style.display = 'none';
      textOutput.value = '';
      extractedText = '';
    }

    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length) handleFile(e.target.files[0]);
    });

    ['dragenter','dragover'].forEach(evt => dropZone.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.add('dragover');
    }));

    ['dragleave','drop'].forEach(evt => dropZone.addEventListener(evt, (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove('dragover');
    }));

    dropZone.addEventListener('drop', (e) => {
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    function isPdfFile(file) {
      if (!file) return false;
      if (file.type === 'application/pdf') return true;
      if (file.name && /\.pdf$/i.test(file.name)) return true;
      return false;
    }

    function handleFile(file) {
      if (!isPdfFile(file)) {
        setStatus('That file is not a PDF. Choose a .pdf file.');
        convertBtn.disabled = true;
        resetResults();
        return;
      }
      currentFile = file;
      setStatus(`Ready: ${file.name}`);
      convertBtn.disabled = false;
      resetResults();
    }

    function createDemoFile() {
      setStatus('Loading demo PDF‚Ä¶');
      const byteString = atob(SAMPLE_PDF_BASE64.replace(/\s+/g, ''));
      const array = new Uint8Array(byteString.length);
      for (let i = 0; i < byteString.length; i++) {
        array[i] = byteString.charCodeAt(i);
      }
      try {
        return new File([array], 'nutrithrive-demo.pdf', { type: 'application/pdf' });
      } catch (err) {
        const blob = new Blob([array], { type: 'application/pdf' });
        blob.name = 'nutrithrive-demo.pdf';
        blob.lastModified = Date.now();
        return blob;
      }
    }

    sampleBtn.addEventListener('click', () => {
      const demo = createDemoFile();
      handleFile(demo);
    });

    convertBtn.addEventListener('click', async () => {
      if (!currentFile) return;
      convertBtn.disabled = true;
      setStatus('Converting‚Ä¶');
      try {
        const text = (await extractTextFromPdf(currentFile)).trim();
        extractedText = text;
        textOutput.value = text || '[No selectable text was found in this PDF.]';
        resultsBlock.style.display = 'flex';
        setStatus(text ? 'Done! Scroll down to copy or download.' : 'Finished, but this PDF had no selectable text.');
      } catch (err) {
        console.error(err);
        setStatus('Something went wrong. Try another PDF or ensure it is not password-protected.');
        resetResults();
      } finally {
        convertBtn.disabled = !currentFile;
      }
    });

    async function extractTextFromPdf(file) {
      if (!window.pdfjsLib) throw new Error('PDF library not loaded');
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let text = '';
      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
        setStatus(`Reading page ${pageNum}/${pdf.numPages}‚Ä¶`);
        const page = await pdf.getPage(pageNum);
        const content = await page.getTextContent();
        const pageText = content.items.map(item => item.str).join(' ');
        text += pageText + '\n\n';
      }
      return text;
    }

    downloadBtn.addEventListener('click', () => {
      if (!extractedText) return alert('Convert a PDF first.');
      const blob = new Blob([extractedText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const base = currentFile ? currentFile.name.replace(/\.pdf$/i, '') : 'converted';
      const a = document.createElement('a');
      a.href = url;
      a.download = `${base || 'converted'}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    copyBtn.addEventListener('click', async () => {
      if (!extractedText) return alert('Convert a PDF first.');
      try {
        await navigator.clipboard.writeText(extractedText);
        copyBtn.textContent = 'Copied!';
        setTimeout(() => copyBtn.textContent = 'Copy text', 1500);
      } catch (err) {
        alert('Clipboard blocked. Please select the text manually.');
      }
    });

    emailBtn.addEventListener('click', () => {
      if (!extractedText) return alert('Convert a PDF first.');
      const email = emailInput.value.trim();
      if (!email) return alert('Enter an email address.');
      const subject = encodeURIComponent('Your converted PDF text');
      const body = encodeURIComponent(extractedText.slice(0, 1500) + '\n\n‚Äî Sent with NutriThrive PDF to TXT');
      window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    });

    // --- TXT to PDF ---
    const txtInput = document.getElementById('txtInput');
    const txtUploadBtn = document.getElementById('txtUploadBtn');
    const txtSampleBtn = document.getElementById('txtSampleBtn');
    const txtConvertBtn = document.getElementById('txtConvertBtn');
    const txtFileInput = document.getElementById('txtFileInput');
    const txtStatus = document.getElementById('txtStatus');

    function setTxtStatus(msg) { txtStatus.textContent = msg; }

    txtUploadBtn.addEventListener('click', () => txtFileInput.click());
    txtFileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (file.type !== 'text/plain') {
        setTxtStatus('Please choose a plain .txt file.');
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        txtInput.value = reader.result;
        setTxtStatus(`Loaded ${file.name}`);
      };
      reader.onerror = () => setTxtStatus('Could not read that file.');
      reader.readAsText(file);
    });

    txtSampleBtn.addEventListener('click', () => {
      txtInput.value = [
        'NutriThrive PDF maker demo',
        '',
        '‚Ä¢ Use this tool to turn quick notes into ready-to-share PDFs.',
        '‚Ä¢ Outline your smoothie recipes, grocery lists, or wellness challenges.',
        '‚Ä¢ Add more text, then tap Make PDF!'
      ].join('\n');
      setTxtStatus('Sample text loaded.');
    });

    txtConvertBtn.addEventListener('click', () => {
      const text = txtInput.value.trim();
      if (!text) {
        setTxtStatus('Type or paste some text first.');
        return;
      }
      if (!window.jspdf || !window.jspdf.jsPDF) {
        setTxtStatus('PDF generator missing. Please reload.');
        return;
      }
      txtConvertBtn.disabled = true;
      setTxtStatus('Rendering PDF‚Ä¶');
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'pt', format: 'a4' });
        const margin = 48;
        const width = doc.internal.pageSize.getWidth() - margin * 2;
        const lines = doc.splitTextToSize(text, width);
        doc.setFont('Times','Normal');
        doc.setFontSize(12);
        doc.text(lines, margin, margin + 12);
        const filename = 'nutrithrive-notes.pdf';
        doc.save(filename);
        setTxtStatus('PDF downloaded!');
      } catch (err) {
        console.error(err);
        setTxtStatus('Could not create PDF.');
      } finally {
        txtConvertBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
