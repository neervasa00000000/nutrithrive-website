# NutriThrive URL Structure Consolidation
# Redirect old /pages/ folders to the new clean structure

# Set directory index files
DirectoryIndex index.html index.htm

# Enable rewrite engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Fix double slashes in URLs (must be first to catch all double slashes)
    # This handles any number of consecutive slashes and reduces them to a single slash
    # Match any path with two or more consecutive slashes
    RewriteCond %{REQUEST_URI} (.*?)(//+)(.*)
    RewriteRule ^(.*)$ %1/%3 [R=301,L]
    
    # Also fix double slashes in query strings if needed
    RewriteCond %{QUERY_STRING} (.*?)(//+)(.*)
    RewriteRule ^(.*)$ $1?%1/%3 [R=301,L]
    
    # Force HTTPS - redirect HTTP to HTTPS
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
    
    # Force non-WWW - redirect www to non-www
    RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
    RewriteRule ^(.*)$ https://%1%{REQUEST_URI} [R=301,L]
    
    # Internal rewrites for /shared/ paths to new organized structure (no redirects)
    # CSS files: /shared/css/ -> /styles/global/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^shared/css/(.+)$ /styles/global/$1 [L]
    # JS files: /shared/js/ -> /scripts/global/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^shared/js/(.+)$ /scripts/global/$1 [L]
    # Images: /shared/images/ -> /assets/images/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^shared/images/(.+)$ /assets/images/$1 [L]
    # Icons: /shared/icon/ -> /assets/icons/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^shared/icon/(.+)$ /assets/icons/$1 [L]
    
    # CRITICAL: Internal rewrites for /pages/blog/ and /pages/products/ (no redirects)
    # These must come early to catch all /pages/blog/ and /pages/products/ URLs
    # Specific product page internal rewrites - exact matches with case-insensitive matching
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^pages/products/product-detail\.html$ /products/moringa-powder/ [L,NC]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^pages/products/product-curry-leaves\.html$ /products/curry-leaves/ [L,NC]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^pages/products/product-black-tea\.html$ /products/black-tea/ [L,NC]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^pages/products/product-combo\.html$ /products/combo-pack/ [L,NC]
    # Product page internal rewrites (old URLs to new folder structure)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-detail\.html$ /products/moringa-powder/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-curry-leaves\.html$ /products/curry-leaves/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-black-tea\.html$ /products/black-tea/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-moringa-soap\.html$ /products/moringa-soap/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-combo\.html$ /products/combo-pack/ [L]
    # Blog redirects
    RewriteRule ^pages/blog/(.+\.html)$ /blog/$1 [R=301,L]
    RewriteRule ^pages/blog/(.+)$ /blog/$1.html [R=301,L]
    RewriteRule ^pages/blog/?$ /blog/ [R=301,L]
    
    # Fix case sensitivity for Image-Enhancer
    
    # ---- Google Search Console 404 fixes (explicit legacy URL redirects) ----
    # Old /pages/blog/ slug that no longer exists (and sometimes has a stray "}" at the end)
    RewriteRule ^pages/blog/where-to-buy-dried-curry-leaves-melbourne-ultimate-guide-surprise-tip-2025\.html\}?$ /blog/where-to-buy-dried-curry-leaves-melbourne-complete-local-buyers-guide.html [R=301,L]
    
    # Old/typo blog slugs
    RewriteRule ^blog/everything-you-need-know-moringa-2025-faq\.html$ /blog/everything-about-moringa-2025-faq.html [R=301,L]
    RewriteRule ^blog/sneak-greens-kids-diet-moringa-hack\.html$ /blog/sneak-greens-into-kids-diet-moringa-hack.html [R=301,L]
    RewriteRule ^blog/moringa-magic-natural-glow\.html$ /blog/edible-beauty-summer-glow-moringa-2025.html [R=301,L]
    RewriteRule ^blog/moringa-benefits\.html$ /blog/moringa-benefits-australia-2025.html [R=301,L]
    
    
    # Common wrong paths
    RewriteRule ^blog/blog\.html$ /blog/ [R=301,L]
    RewriteRule ^products/?$ /products/ [R=301,L]
    RewriteRule ^moringa-benefits/?$ /pages/usage-guide/how-to-use-moringa.html [R=301,L]
    RewriteRule ^about-us/?$ /pages/about/about.html [R=301,L]
    RewriteRule ^reviews/?$ /products/ [R=301,L]
    RewriteRule ^recipes/high-protein-smoothies\.pdf$ /blog/3-instagram-worthy-moringa-smoothie-bowls-recipes.html [R=301,L]
    
    # Blog redirects - redirect ALL /pages/blog/ to /blog/ (already handled above, but keeping for fallback)
    
    # Handle direct /blog/ URLs without .html extension
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} ^/blog/(.+)$
    RewriteCond %{REQUEST_URI} !\.html$
    RewriteCond %{DOCUMENT_ROOT}/blog/%1.html -f
    RewriteRule ^blog/(.+)$ /blog/$1.html [R=301,L]
    
    # Products: Serve product pages without .html extension directly (200 status)
    # This must come BEFORE the redirect rules to serve files directly
    # Internal rewrite (no redirect) - returns 200 status
    # Product clean URLs - Internal rewrites to new folder structure
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-detail/?$ /products/moringa-powder/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-curry-leaves/?$ /products/curry-leaves/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-black-tea/?$ /products/black-tea/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-combo/?$ /products/combo-pack/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^products/product-moringa-soap/?$ /products/moringa-soap/ [L]
    
    # Privacy Policy: Serve clean URL internally (no redirect) - Internal rewrite to new location
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^privacy-policy/?$ /pages/legal/privacy-policy.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^privacy-policy\.html$ /pages/legal/privacy-policy.html [L]
    
    # Cart: Serve clean URL internally (no redirect) - Internal rewrite to new location
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^cart/?$ /pages/shop/cart.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^cart\.html$ /pages/shop/cart.html [L]
    
    # About, Contact, FAQ: Internal rewrites to /pages/ locations (no redirects)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^about\.html$ /pages/about/about.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^contact\.html$ /pages/contact/contact.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^faq\.html$ /pages/faq/faq.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^thank-you\.html$ /pages/contact/thank-you.html [L]
    
    # Products redirects - redirect all /pages/products/ to /products/ (already handled above, but keeping for fallback)
    
    # Clean URL internal rewrites for main pages (without trailing slash) - No redirects
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^faq/?$ /pages/faq/faq.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^contact/?$ /pages/contact/contact.html [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^about/?$ /pages/about/about.html [L]
    
    # Homepage redirect
    RewriteRule ^pages/homepage/(.*)$ /$1 [R=301,L]
    RewriteRule ^pages/homepage/?$ / [R=301,L]
    
    # Fix root-level URLs that Google is trying to access (404 errors) - Internal rewrites
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^product-detail\.html$ /products/moringa-powder/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^product-black-tea\.html$ /products/black-tea/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^product-curry-leaves\.html$ /products/curry-leaves/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^product-combo\.html$ /products/combo-pack/ [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^product-moringa-soap\.html$ /products/moringa-soap/ [L]
    # Removed - now handled by internal rewrite above
    RewriteRule ^blog\.html$ /blog/ [R=301,L]
    # Removed - now handled by internal rewrite above
    RewriteRule ^how-to-use-moringa\.html$ /pages/usage-guide/how-to-use-moringa.html [R=301,L]
    RewriteRule ^how-to-use-moringa/?$ /pages/usage-guide/how-to-use-moringa.html [R=301,L]
    # Removed - now handled by internal rewrite above
    RewriteRule ^moringa-benefits\.html$ /pages/usage-guide/how-to-use-moringa.html [R=301,L]
    RewriteRule ^products\.html$ /products/ [R=301,L]
    
    # Fix incorrect URL paths causing 301 redirects
    RewriteRule ^about/about\.html$ /pages/about/about.html [R=301,L]
    RewriteRule ^contact/contact\.html$ /pages/contact/contact.html [R=301,L]
    RewriteRule ^homepage/index\.html$ / [R=301,L]
    RewriteRule ^homepage/?$ / [R=301,L]
    
    # Fix blog redirects
    RewriteRule ^pages/blog/blog\.html$ /blog/ [R=301,L]
    RewriteRule ^blog/blog\.html\.html$ /blog/ [R=301,L]
    
    # Fix case sensitivity for Image-Enhancer
    
    # Fix double .html.html extensions (Google Search Console errors)
    RewriteRule ^(.+)\.html\.html$ /$1.html [R=301,L]
    
    # Fix root-level /product-detail without .html (redirect to /products/)
    RewriteRule ^product-detail/?$ /products/product-detail.html [R=301,L]
    
    # Redirect non-existent blog posts to actual files
    RewriteRule ^blog/natural-eye-health-supplements-australia\.html$ /blog/moringa-eyesight-better-than-carrots.html [R=301,L]
    RewriteRule ^blog/natural-cholesterol-lowering-supplements-australia-moringa\.html$ /blog/lower-cholesterol-naturally-moringa-heart-health.html [R=301,L]
    RewriteRule ^blog/ultimate-moringa-guide-australia-benefits\.html$ /blog/everything-about-moringa-2025-faq.html [R=301,L]
    RewriteRule ^blog/hidden-veggies-picky-eaters-kids-immunity\.html$ /blog/sneak-greens-into-kids-diet-moringa-hack.html [R=301,L]
    
    # Fix broken image URLs (404 errors from Google Search Console)
    # Redirect old Dried_curry_leaves directory paths to random folder
    RewriteRule ^shared/images/Dried_curry_leaves/Curry3\.png$ /shared/images/random/CURRY3.png [R=301,L]
    RewriteRule ^shared/images/Dried_curry_leaves/Curry2\.png$ /shared/images/random/Curry2.png [R=301,L]
    RewriteRule ^shared/images/Dried_curry_leaves/Curry1\.png$ /shared/images/random/Curry1.png [R=301,L]
    RewriteRule ^shared/images/Dried_curry_leaves/Curry1 .png$ /shared/images/random/Curry1.png [R=301,L]
    RewriteRule ^shared/images/Dried_curry_leaves/4\.png$ /shared/images/random/4.png [R=301,L]
    RewriteRule ^shared/images/Dried_curry_leaves/energy-boosters\.png$ /shared/images/random/energy-boosters.png [R=301,L]
    # Redirect old Moringa directory paths to random folder
    RewriteRule ^shared/images/Moringa%20/Moringa\.png$ /shared/images/random/Moringa.png [R=301,L]
    RewriteRule ^shared/images/Moringa /Moringa\.png$ /shared/images/random/Moringa.png [R=301,L]
    RewriteRule ^shared/images/Moringa/Moringa\.png$ /shared/images/random/Moringa.png [R=301,L]
    RewriteRule ^shared/images/Moringa%20/moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg [R=301,L]
    RewriteRule ^shared/images/Moringa /moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg [R=301,L]
    RewriteRule ^shared/images/Moringa/moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg [R=301,L]
    RewriteRule ^shared/images/Moringa/athletes\.png$ /shared/images/random/athletes.png [R=301,L]
    # Redirect incorrect /blog/shared/images/ paths
    RewriteRule ^blog/shared/images/Moringa/moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg [R=301,L]
    RewriteRule ^blog/shared/images/Moringa/athletes\.png$ /shared/images/random/athletes.png [R=301,L]
    # Redirect other missing images to appropriate existing images
    RewriteRule ^shared/images/pinterest-diy-hair-growth-oil-australian-ingredients\.jpg$ /shared/images/random/Curry1.png [R=301,L]
    RewriteRule ^shared/images/dried-curry-leaves-cooking-soup\.jpg$ /shared/images/random/Curry1.png [R=301,L]
    RewriteRule ^shared/images/curry-leaf-tea-recipe-australia\.jpg$ /shared/images/random/Curry1.png [R=301,L]
</IfModule>

# Fallback Apache redirects (if mod_rewrite is not available)
# ---- Google Search Console 404 fixes (explicit legacy URL redirects) ----
RedirectMatch 301 ^/pages/blog/where-to-buy-dried-curry-leaves-melbourne-ultimate-guide-surprise-tip-2025\.html\}?$ /blog/where-to-buy-dried-curry-leaves-melbourne-complete-local-buyers-guide.html
RedirectMatch 301 ^/blog/everything-you-need-know-moringa-2025-faq\.html$ /blog/everything-about-moringa-2025-faq.html
RedirectMatch 301 ^/blog/sneak-greens-kids-diet-moringa-hack\.html$ /blog/sneak-greens-into-kids-diet-moringa-hack.html
RedirectMatch 301 ^/blog/moringa-magic-natural-glow\.html$ /blog/edible-beauty-summer-glow-moringa-2025.html
RedirectMatch 301 ^/blog/moringa-benefits\.html$ /blog/moringa-benefits-australia-2025.html
RedirectMatch 301 ^/blog/blog\.html$ /blog/
RedirectMatch 301 ^/products/?$ /products/
RedirectMatch 301 ^/moringa-benefits/?$ /pages/usage-guide/how-to-use-moringa.html
RedirectMatch 301 ^/about-us/?$ /pages/about/about.html
RedirectMatch 301 ^/reviews/?$ /products/
RedirectMatch 301 ^/recipes/high-protein-smoothies\.pdf$ /blog/3-instagram-worthy-moringa-smoothie-bowls-recipes.html
# Blog redirects - handle URLs with .html extension first (exact match)
RedirectMatch 301 ^/pages/blog/(.+\.html)$ /blog/$1
# Then handle URLs without .html extension (add .html)
RedirectMatch 301 ^/pages/blog/(.+)$ /blog/$1.html

# Products redirects - Force redirect for all /pages/products/ URLs
RedirectMatch 301 ^/pages/products/product-detail\.html$ /products/product-detail.html
RedirectMatch 301 ^/pages/products/product-curry-leaves\.html$ /products/product-curry-leaves.html
RedirectMatch 301 ^/pages/products/product-black-tea\.html$ /products/product-black-tea.html
RedirectMatch 301 ^/pages/products/product-combo\.html$ /products/product-combo.html
RedirectMatch 301 ^/pages/products/(.*)$ /products/$1

# Homepage redirect
RedirectMatch 301 ^/pages/homepage/(.*)$ /$1

# Fix root-level URLs that Google is trying to access (404 errors)
RedirectMatch 301 ^/product-detail\.html$ /products/product-detail.html
RedirectMatch 301 ^/product-black-tea\.html$ /products/product-black-tea.html
RedirectMatch 301 ^/product-curry-leaves\.html$ /products/product-curry-leaves.html
# Removed - now handled by internal rewrite above
RedirectMatch 301 ^/blog\.html$ /blog/
# Removed - now handled by internal rewrite above
RedirectMatch 301 ^/how-to-use-moringa\.html$ /pages/usage-guide/how-to-use-moringa.html
RedirectMatch 301 ^/how-to-use-moringa/?$ /pages/usage-guide/how-to-use-moringa.html
# Removed - now handled by internal rewrite above
RedirectMatch 301 ^/moringa-benefits\.html$ /pages/usage-guide/how-to-use-moringa.html
RedirectMatch 301 ^/products\.html$ /products/

# Fix incorrect URL paths causing 301 redirects
RedirectMatch 301 ^/about/about\.html$ /pages/about/about.html
RedirectMatch 301 ^/contact/contact\.html$ /pages/contact/contact.html
RedirectMatch 301 ^/homepage/index\.html$ /
RedirectMatch 301 ^/homepage/?$ /

# Fix blog redirects
RedirectMatch 301 ^/pages/blog/blog\.html$ /blog/
RedirectMatch 301 ^/blog/blog\.html\.html$ /blog/

# Fix double .html.html extensions (Google Search Console errors)
RedirectMatch 301 ^/(.+)\.html\.html$ /$1.html

# Fix /product-detail without .html
RedirectMatch 301 ^/product-detail/?$ /products/product-detail.html

# Redirect non-existent blog posts to actual files
RedirectMatch 301 ^/blog/natural-eye-health-supplements-australia\.html$ /blog/moringa-eyesight-better-than-carrots.html
RedirectMatch 301 ^/blog/natural-cholesterol-lowering-supplements-australia-moringa\.html$ /blog/lower-cholesterol-naturally-moringa-heart-health.html
RedirectMatch 301 ^/blog/ultimate-moringa-guide-australia-benefits\.html$ /blog/everything-about-moringa-2025-faq.html
RedirectMatch 301 ^/blog/hidden-veggies-picky-eaters-kids-immunity\.html$ /blog/sneak-greens-into-kids-diet-moringa-hack.html

# Fix broken image URLs (404 errors from Google Search Console)
# Redirect old Dried_curry_leaves directory paths to random folder
RedirectMatch 301 ^/shared/images/Dried_curry_leaves/Curry3\.png$ /shared/images/random/CURRY3.png
RedirectMatch 301 ^/shared/images/Dried_curry_leaves/Curry2\.png$ /shared/images/random/Curry2.png
RedirectMatch 301 ^/shared/images/Dried_curry_leaves/Curry1\.png$ /shared/images/random/Curry1.png
RedirectMatch 301 ^/shared/images/Dried_curry_leaves/Curry1%20\.png$ /shared/images/random/Curry1.png
RedirectMatch 301 ^/shared/images/Dried_curry_leaves/4\.png$ /shared/images/random/4.png
RedirectMatch 301 ^/shared/images/Dried_curry_leaves/energy-boosters\.png$ /shared/images/random/energy-boosters.png
# Redirect old Moringa directory paths to random folder
RedirectMatch 301 ^/shared/images/Moringa%20/Moringa\.png$ /shared/images/random/Moringa.png
RedirectMatch 301 ^/shared/images/Moringa /Moringa\.png$ /shared/images/random/Moringa.png
RedirectMatch 301 ^/shared/images/Moringa/Moringa\.png$ /shared/images/random/Moringa.png
RedirectMatch 301 ^/shared/images/Moringa%20/moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg
RedirectMatch 301 ^/shared/images/Moringa /moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg
RedirectMatch 301 ^/shared/images/Moringa/moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg
RedirectMatch 301 ^/shared/images/Moringa/athletes\.png$ /shared/images/random/athletes.png
# Redirect incorrect /blog/shared/images/ paths
RedirectMatch 301 ^/blog/shared/images/Moringa/moringa-hero\.jpg$ /shared/images/random/moringa-hero.jpg
RedirectMatch 301 ^/blog/shared/images/Moringa/athletes\.png$ /shared/images/random/athletes.png
# Redirect other missing images to appropriate existing images
RedirectMatch 301 ^/shared/images/pinterest-diy-hair-growth-oil-australian-ingredients\.jpg$ /shared/images/random/Curry1.png
RedirectMatch 301 ^/shared/images/dried-curry-leaves-cooking-soup\.jpg$ /shared/images/random/Curry1.png
RedirectMatch 301 ^/shared/images/curry-leaf-tea-recipe-australia\.jpg$ /shared/images/random/Curry1.png
