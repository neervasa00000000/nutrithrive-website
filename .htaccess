# NutriThrive URL Structure Consolidation
# Redirect old /pages/ folders to the new clean structure

# Set directory index files
DirectoryIndex index.html index.htm

# Enable rewrite engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Blog redirects - redirect ALL /pages/blog/ to /blog/
    # First: Handle /pages/blog/ directory - redirect to /blog/
    RewriteRule ^pages/blog/?$ /blog/ [R=301,L]
    
    # Second: Handle /pages/blog/ URLs with .html extension - redirect to /blog/
    RewriteCond %{REQUEST_URI} ^/pages/blog/(.+\.html)$
    RewriteRule ^pages/blog/(.+\.html)$ /blog/$1 [R=301,L]
    
    # Third: Handle /pages/blog/ URLs without .html - check if file exists and redirect
    RewriteCond %{REQUEST_URI} ^/pages/blog/(.+)$
    RewriteCond %{REQUEST_URI} !\.html$
    RewriteCond %{DOCUMENT_ROOT}/blog/%1.html -f
    RewriteRule ^pages/blog/(.+)$ /blog/$1.html [R=301,L]
    
    # Fourth: Catch-all for any other /pages/blog/ URLs (without .html, always add .html)
    RewriteCond %{REQUEST_URI} ^/pages/blog/(.+)$
    RewriteCond %{REQUEST_URI} !\.html$
    RewriteRule ^pages/blog/(.+)$ /blog/$1.html [R=301,L]
    
    # Handle direct /blog/ URLs without .html extension
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} ^/blog/(.+)$
    RewriteCond %{REQUEST_URI} !\.html$
    RewriteCond %{DOCUMENT_ROOT}/blog/%1.html -f
    RewriteRule ^blog/(.+)$ /blog/$1.html [R=301,L]
    
    # Products redirects - redirect all /pages/products/ to /products/
    RewriteRule ^pages/products/(.*)$ /products/$1 [R=301,L]
    RewriteRule ^pages/products/?$ /products/ [R=301,L]
    
    # Homepage redirect
    RewriteRule ^pages/homepage/(.*)$ /$1 [R=301,L]
    RewriteRule ^pages/homepage/?$ / [R=301,L]
</IfModule>

# Fallback Apache redirects (if mod_rewrite is not available)
# Blog redirects - handle URLs with .html extension first (exact match)
RedirectMatch 301 ^/pages/blog/(.+\.html)$ /blog/$1
# Then handle URLs without .html extension (add .html) - must not end with .html
RedirectMatch 301 ^/pages/blog/([^/]+)$ /blog/$1.html

# Products redirects  
RedirectMatch 301 ^/pages/products/(.*)$ /products/$1

# Homepage redirect
RedirectMatch 301 ^/pages/homepage/(.*)$ /$1
